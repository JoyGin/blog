
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>android插件化代理实现 · HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 5.1.4">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="android插件化Hook实现.html" />
    
    
    <link rel="prev" href="android通过gradle使用protobuf.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="android.html">
            
                <a href="android.html">
            
                    
                    Android
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="第一个view的measureSpec是如何生成的.html">
            
                <a href="第一个view的measureSpec是如何生成的.html">
            
                    
                    第一个view的measureSpec是如何生成的
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="添加so文件.html">
            
                <a href="添加so文件.html">
            
                    
                    添加so文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="android使用protobuf.html">
            
                <a href="android使用protobuf.html">
            
                    
                    android使用protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="android通过gradle使用protobuf.html">
            
                <a href="android通过gradle使用protobuf.html">
            
                    
                    android通过gradle使用protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.1.5" data-path="android插件化代理实现.html">
            
                <a href="android插件化代理实现.html">
            
                    
                    android插件化代理实现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="android插件化Hook实现.html">
            
                <a href="android插件化Hook实现.html">
            
                    
                    android插件化Hook实现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7" data-path="Make、Makefile、CMake和CMakeLists.txt之间的关系.html">
            
                <a href="Make、Makefile、CMake和CMakeLists.txt之间的关系.html">
            
                    
                    Make、Makefile、CMake和CMakeLists.txt之间的关系
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.8" data-path="Android.mk和CmakeLists.txt区别.html">
            
                <a href="Android.mk和CmakeLists.txt区别.html">
            
                    
                    Android.mk和CmakeLists.txt区别
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.9" data-path="Android.mk和Application.mk.html">
            
                <a href="Android.mk和Application.mk.html">
            
                    
                    Android.mk和Application.mk
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.10" data-path="Android_NDK下Cmake的构建过程.html">
            
                <a href="Android_NDK下Cmake的构建过程.html">
            
                    
                    Android NDK 下 Cmake 的构建过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.11" data-path="AccessibilityService.html">
            
                <a href="AccessibilityService.html">
            
                    
                    AccessibilityService
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../ios/ios.html">
            
                <a href="../ios/ios.html">
            
                    
                    iOS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../ios/iOS_crash分析.html">
            
                <a href="../ios/iOS_crash分析.html">
            
                    
                    iOS crash分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../c_c++/c_c++.html">
            
                <a href="../c_c++/c_c++.html">
            
                    
                    C/C++
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../c_c++/clang和gcc.html">
            
                <a href="../c_c++/clang和gcc.html">
            
                    
                    clang和gcc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../c_c++/cmakeList.html">
            
                <a href="../c_c++/cmakeList.html">
            
                    
                    cmakeList
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="../c_c++/fork创建子进程.html">
            
                <a href="../c_c++/fork创建子进程.html">
            
                    
                    fork()创建子进程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="../c_c++/vscode_C++开发配置.html">
            
                <a href="../c_c++/vscode_C++开发配置.html">
            
                    
                    vscode C++开发配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../frontend/frontend.html">
            
                <a href="../frontend/frontend.html">
            
                    
                    前端
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="../frontend/ES6的模块化语法.html">
            
                <a href="../frontend/ES6的模块化语法.html">
            
                    
                    ES6的模块化语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="../frontend/javascript模块化历程.html">
            
                <a href="../frontend/javascript模块化历程.html">
            
                    
                    javascript模块化历程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="../frontend/npm常用命令.html">
            
                <a href="../frontend/npm常用命令.html">
            
                    
                    npm常用命令
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../go/go.html">
            
                <a href="../go/go.html">
            
                    
                    GO
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../go/GOPATH和GOROOT.html">
            
                <a href="../go/GOPATH和GOROOT.html">
            
                    
                    GOPATH 和 GOROOT
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../java/java.html">
            
                <a href="../java/java.html">
            
                    
                    Java
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1.1" data-path="../java/java内存空间和内存回收算法.html">
            
                <a href="../java/java内存空间和内存回收算法.html">
            
                    
                    java内存空间和内存回收算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.2" data-path="../java/java线程间数据共享.html">
            
                <a href="../java/java线程间数据共享.html">
            
                    
                    java线程间数据共享
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.3" data-path="../java/ServiceLoader使用.html">
            
                <a href="../java/ServiceLoader使用.html">
            
                    
                    ServiceLoader使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.4" data-path="../java/虚引用.html">
            
                <a href="../java/虚引用.html">
            
                    
                    虚引用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../network/network.html">
            
                <a href="../network/network.html">
            
                    
                    计算机网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1.1" data-path="../network/vpn.html">
            
                <a href="../network/vpn.html">
            
                    
                    vpn
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="../os/os.html">
            
                <a href="../os/os.html">
            
                    
                    操作系统
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1.1" data-path="../os/epoll.html">
            
                <a href="../os/epoll.html">
            
                    
                    epoll
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="../gist/gist.html">
            
                <a href="../gist/gist.html">
            
                    
                    代码片段
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1.1" data-path="../gist/android/android.html">
            
                <a href="../gist/android/android.html">
            
                    
                    Android代码片段
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1.1.1" data-path="../gist/android/实现悬浮窗功能.html">
            
                <a href="../gist/android/实现悬浮窗功能.html">
            
                    
                    实现悬浮窗功能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.1.1.2" data-path="../gist/android/将某个activity提到最前.html">
            
                <a href="../gist/android/将某个activity提到最前.html">
            
                    
                    将某个activity提到最前
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.1.1.3" data-path="../gist/android/获取webView日志.html">
            
                <a href="../gist/android/获取webView日志.html">
            
                    
                    获取webView日志
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.1.1.4" data-path="../gist/android/获取状态栏高度.html">
            
                <a href="../gist/android/获取状态栏高度.html">
            
                    
                    获取状态栏高度
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.1.1.5" data-path="../gist/android/让应用不出现在最近应用中.html">
            
                <a href="../gist/android/让应用不出现在最近应用中.html">
            
                    
                    让应用不出现在最近应用中
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.1.1.6" data-path="../gist/android/请求悬浮窗权限.html">
            
                <a href="../gist/android/请求悬浮窗权限.html">
            
                    
                    请求悬浮窗权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.1.1.7" data-path="../gist/android/通过应用包名打开应用.html">
            
                <a href="../gist/android/通过应用包名打开应用.html">
            
                    
                    通过应用包名打开应用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10.1.2" data-path="../gist/flutter/flutter.html">
            
                <a href="../gist/flutter/flutter.html">
            
                    
                    flutter
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1.2.1" data-path="../gist/flutter/flutter异步加载组件.html">
            
                <a href="../gist/flutter/flutter异步加载组件.html">
            
                    
                    flutter异步加载组件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.1.2.2" data-path="../gist/flutter/获取图片高度.html">
            
                <a href="../gist/flutter/获取图片高度.html">
            
                    
                    获取图片高度
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.1.2.3" data-path="../gist/flutter/解决按英文单词自动换行的问题.html">
            
                <a href="../gist/flutter/解决按英文单词自动换行的问题.html">
            
                    
                    解决按英文单词自动换行的问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10.1.3" data-path="../gist/js/js.html">
            
                <a href="../gist/js/js.html">
            
                    
                    js
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1.3.1" data-path="../gist/js/判断当前是企飞钉浏览环境.html">
            
                <a href="../gist/js/判断当前是企飞钉浏览环境.html">
            
                    
                    判断当前是企飞钉浏览环境
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="11.1" data-path="../other/other.html">
            
                <a href="../other/other.html">
            
                    
                    其它
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="11.1.1" data-path="../other/hexdump使用.html">
            
                <a href="../other/hexdump使用.html">
            
                    
                    hexdump使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.1.2" data-path="../other/objdump使用.html">
            
                <a href="../other/objdump使用.html">
            
                    
                    objdump使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.1.3" data-path="../other/linux安装ffmpeg.html">
            
                <a href="../other/linux安装ffmpeg.html">
            
                    
                    linux安装ffmpeg
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.1.4" data-path="../other/使用GDB分析C++动态符号解析执行过程.html">
            
                <a href="../other/使用GDB分析C++动态符号解析执行过程.html">
            
                    
                    使用GDB分析C++动态符号解析执行过程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >android插件化代理实现</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="android插件化">Android插件化</h1>
<p>搬运至：<a href="https://juejin.cn/post/6973888932572315678#heading-0" target="_blank">https://juejin.cn/post/6973888932572315678#heading-0</a></p>
<h4 id="一、认识插件化">一、认识插件化</h4>
<h5 id="11-插件化起源">1.1 插件化起源</h5>
<p>插件化技术最初源于免安装运行 Apk的想法，这个免安装的 Apk 就可以理解为插件，而支持插件的 app 我们一般叫 宿主。
想必大家都知道，在 Android 系统中，应用是以 Apk 的形式存在的，应用都需要安装才能使用。但实际上 Android 系统安装应用的方式相当简单，其实就是把应用 Apk 拷贝到系统不同的目录下、然后把 so 解压出来而已。</p>
<p>常见的应用安装目录有：</p>
<ul>
<li>/system/app：系统应用</li>
<li>/system/priv-app：系统应用</li>
<li>/data/app：用户应用</li>
</ul>
<p>那可能大家会想问，既然安装这个过程如此简单，Android 是怎么运行应用中的代码的呢，我们先看 Apk 的构成，一个常见的 Apk 会包含如下几个部分：</p>
<ul>
<li>classes.dex：Java 代码字节码</li>
<li>res：资源文件</li>
<li>lib：so 文件</li>
<li>assets：静态资产文件</li>
<li>AndroidManifest.xml：清单文件</li>
</ul>
<p>其实 Android 系统在打开应用之后，也只是开辟进程，然后使用 ClassLoader 加载 classes.dex 至进程中，执行对应的组件而已。
那大家可能会想一个问题，既然 Android 本身也是使用类似反射的形式加载代码执行，凭什么我们不能执行一个 Apk 中的代码呢？</p>
<h5 id="12-插件化优点">1.2 插件化优点</h5>
<p>插件化让 Apk 中的代码（主要是指 Android 组件）能够免安装运行，这样能够带来很多收益：</p>
<p>减少安装Apk的体积、按需下载模块
动态更新插件
宿主和插件分开编译，提升开发效率
解决方法数超过65535的问题</p>
<p>想象一下，你的应用拥有 Native 应用一般极高的性能，又能获取诸如 Web 应用一样的收益。
嗯，理想很美好不是嘛？</p>
<h5 id="13-与组件化的区别">1.3 与组件化的区别</h5>
<p>组件化：是将一个App分成多个模块，每个模块都是一个组件（module），开发过程中可以让这些组件相互依赖或独立编译、调试部分组件，但是这些组件最终会合并成一个完整的Apk去发布到应用市场。
插件化：是将整个App拆分成很多模块，每个模块都是一个Apk（组件化的每个模块是一个lib），最终打包的时候将宿主Apk和插件Apk分开打包，只需发布宿主Apk到应用市场，插件Apk通过动态按需下发到宿主Apk。</p>
<h4 id="二、插件化的技术难点">二、插件化的技术难点</h4>
<p>想让插件的Apk真正运行起来，首先要先能找到插件Apk的存放位置，然后我们要能解析加载Apk里面的代码。
但是光能执行Java代码是没有意义的，在Android系统中有四大组件是需要在系统中注册的，具体来说是在 Android 系统的 ActivityManagerService (AMS) 和 PackageManagerService (PMS) 中注册的，而四大组件的解析和启动都需要依赖 AMS 和 PMS，如何欺骗系统，让他承认一个未安装的 Apk 中的组件，如何让宿主动态加载执行插件Apk中 Android 组件（即 Activity、Service、BroadcastReceiver、ContentProvider、Fragment）等是插件化最大的难点。
另外，应用资源引用（特指 R 中引用的资源，如 layout、values 等）也是一大问题，想象一下你在宿主进程中使用反射加载了一个插件 Apk，代码中的 R 对应的 id 却无法引用到正确的资源，会产生什么后果。
总结一下，其实做到插件化的要点就这几个：</p>
<ul>
<li>如何加载并执行插件 Apk 中的代码（ClassLoader Injection）</li>
<li>让系统能调用插件 Apk 中的组件（Runtime Container）</li>
<li>正确识别插件 Apk 中的资源（Resource Injection）</li>
</ul>
<p>当然还有其他一些小问题，但可能不是所有场景下都会遇到，我们后面再单独说。</p>
<h4 id="三、classloader-injection">三、ClassLoader Injection</h4>
<p>ClassLoader 是插件化中必须要掌握的，因为我们知道Android 应用本身是基于魔改的 Java 虚拟机的，而由于插件是未安装的 apk，系统不会处理其中的类，所以需要使用 ClassLoader 加载 Apk，然后反射里面的代码。</p>
<h5 id="31-java-中的-classloader">3.1 java 中的 ClassLoader</h5>
<ul>
<li><p>BootstrapClassLoader
负责加载 JVM 运行时的核心类，比如 JAVA_HOME/lib/rt.jar 等等</p>
</li>
<li><p>ExtensionClassLoader
负责加载 JVM 的扩展类，比如 JAVA_HOME/lib/ext 下面的 jar 包</p>
</li>
<li><p>AppClassLoader
负责加载 classpath 里的 jar 包和目录</p>
</li>
</ul>
<h5 id="32-android-中的-classloader">3.2 android 中的 ClassLoader</h5>
<p>在Android系统中ClassLoader是用来加载dex文件的，有包含 dex 的 apk 文件以及 jar 文件，dex 文件是一种对class文件优化的产物，在Android中应用打包时会把所有class文件进行合并、优化（把不同的class文件重复的东西只保留一份），然后生成一个最终的class.dex文件</p>
<ul>
<li><p>PathClassLoader 用来加载系统类和应用程序类，可以加载已经安装的 apk 目录下的 dex 文件</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PathClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDexClassLoader</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">PathClassLoader</span><span class="hljs-params">(String dexPath, ClassLoader parent)</span> {
      <span class="hljs-built_in">super</span>(dexPath, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, parent);
  }

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">PathClassLoader</span><span class="hljs-params">(String dexPath, String libraryPath,
          ClassLoader parent)</span> {
      <span class="hljs-built_in">super</span>(dexPath, <span class="hljs-literal">null</span>, libraryPath, parent);
  }
}
</code></pre>
</li>
<li><p>DexClassLoader 用来加载 dex 文件，可以从存储空间加载 dex 文件。</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DexClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDexClassLoader</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">DexClassLoader</span><span class="hljs-params">(String dexPath, String optimizedDirectory,
          String libraryPath, ClassLoader parent)</span> {
      <span class="hljs-built_in">super</span>(dexPath, <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(optimizedDirectory), libraryPath, parent);
  }
}
</code></pre>
<p>我们在插件化中一般使用的是 DexClassLoader。</p>
</li>
</ul>
<h5 id="33-双亲委派机制">3.3 双亲委派机制</h5>
<p>每一个 ClassLoader 中都有一个 parent 对象，代表的是父类加载器，在加载一个类的时候，会先使用父类加载器去加载，如果在父类加载器中没有找到，自己再进行加载，如果 parent 为空，那么就用系统类加载器来加载。通过这样的机制可以保证系统类都是由系统类加载器加载的。 下面是 ClassLoader 的 loadClass 方法的具体实现。</p>
<pre><code class="lang-java"><span class="hljs-keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="hljs-type">boolean</span> resolve)
    <span class="hljs-keyword">throws</span> ClassNotFoundException
{
        <span class="hljs-comment">// First, check if the class has already been loaded</span>
        Class&lt;?&gt; c = findLoadedClass(name);
        <span class="hljs-keyword">if</span> (c == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> (parent != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// 先从父类加载器中进行加载</span>
                    c = parent.loadClass(name, <span class="hljs-literal">false</span>);
                } <span class="hljs-keyword">else</span> {
                    c = findBootstrapClassOrNull(name);
                }
            } <span class="hljs-keyword">catch</span> (ClassNotFoundException e) {
                <span class="hljs-comment">// ClassNotFoundException thrown if class not found</span>
                <span class="hljs-comment">// from the non-null parent class loader</span>
            }

            <span class="hljs-keyword">if</span> (c == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// 没有找到，再自己加载</span>
                c = findClass(name);
            }
        }
        <span class="hljs-keyword">return</span> c;
}
</code></pre>
<h5 id="34-如何加载插件中的类">3.4 如何加载插件中的类</h5>
<p>要加载插件中的类，我们首先要创建一个 DexClassLoader，先看下 DexClassLoader 的构造函数需要哪些参数。</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DexClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDexClassLoader</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DexClassLoader</span><span class="hljs-params">(String dexPath, String optimizedDirectory, String librarySearchPath, ClassLoader parent)</span> {
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>构造函数需要四个参数：</p>
<ul>
<li>dexPath 是需要加载的 dex / apk / jar 文件路径</li>
<li>optimizedDirectory 是 dex 优化后存放的位置，在 ART 上，会执行 oat 对 dex 进行优化，生成机器码，这里就是存放优化后的 odex 文件的位置</li>
<li>librarySearchPath 是 native 依赖的位置</li>
<li>parent 就是父类加载器，默认会先从 parent 加载对应的类</li>
</ul>
<p>创建出 DexClassLaoder 实例以后，只要调用其 loadClass(className) 方法就可以加载插件中的类了。具体的实现在下面：</p>
<pre><code class="lang-kotlin"><span class="hljs-comment">// 从 assets 中拿出插件 apk 放到内部存储空间</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">extractPlugin</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> inputStream = assets.<span class="hljs-keyword">open</span>(<span class="hljs-string">&quot;plugin.apk&quot;</span>)
    File(filesDir.absolutePath, <span class="hljs-string">&quot;plugin.apk&quot;</span>).writeBytes(inputStream.readBytes())
}

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {
    extractPlugin()
    pluginPath = File(filesDir.absolutePath, <span class="hljs-string">&quot;plugin.apk&quot;</span>).absolutePath
    nativeLibDir = File(filesDir, <span class="hljs-string">&quot;pluginlib&quot;</span>).absolutePath
    dexOutPath = File(filesDir, <span class="hljs-string">&quot;dexout&quot;</span>).absolutePath
    <span class="hljs-comment">// 生成 DexClassLoader 用来加载插件类</span>
    pluginClassLoader = DexClassLoader(pluginPath, dexOutPath, nativeLibDir, <span class="hljs-keyword">this</span>::<span class="hljs-keyword">class</span>.java.classLoader)
}
</code></pre>
<p><img src="../pics/android-plugin-pic1.png" style="display: block; margin: auto;" height="50%" width="50%"></p>
<h5 id="35-执行插件类的方法">3.5 执行插件类的方法</h5>
<p>通过反射来执行类的方法</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">val</span> loadClass = pluginClassLoader.loadClass(activityName)
loadClass.getMethod(<span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-literal">null</span>).invoke(loadClass)
</code></pre>
<p>我们称这个过程叫做 ClassLoader 注入。完成注入后，所有来自宿主的类使用宿主的 ClassLoader 进行加载，所有来自插件 Apk 的类使用插件 ClassLoader 进行加载，而由于 ClassLoader 的双亲委派机制，实际上系统类会不受 ClassLoader 的类隔离机制所影响，这样宿主 Apk 就可以在宿主进程中使用来自于插件的组件类了。</p>
<h4 id="四、runtime-container">四、Runtime Container</h4>
<p>我们之前说到 Activity 插件化最大的难点是如何欺骗系统，让他承认一个未安装的 Apk 中的组件。
因为插件是动态加载的，所以插件的四大组件不可能注册到宿主的 Manifest 文件中，而没有在 Manifest 中注册的四大组件是不能和系统直接进行交互的。
如果直接把插件的 Activity 注册到宿主 Manifest 里就失去了插件化的动态特性，因为每次插件中新增 Activity 都要修改宿主 Manifest 并且重新打包，那就和直接写在宿主中没什么区别了。</p>
<h5 id="41-为什么没有注册的-activity-不能和系统交互">4.1 为什么没有注册的 Activity 不能和系统交互</h5>
<p>这里的不能直接交互的含义有两个</p>
<ol>
<li><p>系统会检测 Activity 是否注册 如果我们启动一个没有在 Manifest 中注册的 Activity，会发现报如下 error：</p>
<pre><code class="lang-java">android.content.ActivityNotFoundException: Unable to find explicit activity class {com.zyg.commontec/com.zyg.plugin.PluginActivity}; have you declared <span class="hljs-built_in">this</span> activity in your AndroidManifest.xml?
</code></pre>
<p>这个 log 在 Instrumentation 的 checkStartActivityResult 方法中可以看到：</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Instrumentation</span> {
 <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkStartActivityResult</span><span class="hljs-params">(<span class="hljs-type">int</span> res, Object intent)</span> {
     <span class="hljs-keyword">if</span> (!ActivityManager.isStartResultFatalError(res)) {
         <span class="hljs-keyword">return</span>;
     }

     <span class="hljs-keyword">switch</span> (res) {
         <span class="hljs-keyword">case</span> ActivityManager.START_INTENT_NOT_RESOLVED:
         <span class="hljs-keyword">case</span> ActivityManager.START_CLASS_NOT_FOUND:
             <span class="hljs-keyword">if</span> (intent <span class="hljs-keyword">instanceof</span> Intent &amp;&amp; ((Intent)intent).getComponent() != <span class="hljs-literal">null</span>)
                 <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityNotFoundException</span>(
                         <span class="hljs-string">&quot;Unable to find explicit activity class &quot;</span>
                         + ((Intent)intent).getComponent().toShortString()
                         + <span class="hljs-string">&quot;; have you declared this activity in your AndroidManifest.xml?&quot;</span>);
             <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityNotFoundException</span>(
                     <span class="hljs-string">&quot;No Activity found to handle &quot;</span> + intent);
             ...
     }
 }
}
</code></pre>
</li>
<li><p>Activity 的生命周期无法被调用，其实一个 Activity 主要的工作，都是在其生命周期方法中调用了，既然上一步系统检测了 Manifest 注册文件，启动 Activity 被拒绝，那么其生命周期方法也肯定不会被调用了。从而插件 Activity 也就不能正常运行了。</p>
</li>
</ol>
<h5 id="42-运行时容器技术">4.2 运行时容器技术</h5>
<p>由于Android中的组件（Activity，Service，BroadcastReceiver和ContentProvider）是由系统创建的，并且由系统管理生命周期。 仅仅构造出这些类的实例是没用的，还需要管理组件的生命周期。其中以Activity最为复杂，不同框架采用的方法也不尽相同。插件化如何支持组件生命周期的管理。 大致分为两种方式：</p>
<ul>
<li>运行时容器技术（ProxyActivity代理）</li>
<li>预埋StubActivity，hook系统启动Activity的过程</li>
</ul>
<p>我们的解决方案很简单，即运行时容器技术，简单来说就是在宿主 Apk 中预埋一些空的 Android 组件，以 Activity 为例，我预置一个 ContainerActivity extends Activity 在宿主中，并且在 AndroidManifest.xml 中注册它。</p>
<p>它要做的事情很简单，就是帮助我们作为插件 Activity 的容器，它从 Intent 接受几个参数，分别是插件的不同信息，如：</p>
<ul>
<li>pluginName</li>
<li>pluginApkPath</li>
<li>pluginActivityName</li>
</ul>
<p>等，其实最重要的就是 pluginApkPath 和 pluginActivityName，当 ContainerActivity 启动时，我们就加载插件的 ClassLoader、Resource，并反射 pluginActivityName 对应的 Activity 类。当完成加载后，ContainerActivity 要做两件事：</p>
<ul>
<li>转发所有来自系统的生命周期回调至插件 Activity</li>
<li>接受 Activity 方法的系统调用，并转发回系统</li>
</ul>
<p>我们可以通过复写 ContainerActivity 的生命周期方法来完成第一步，而第二步我们需要定义一个 PluginActivity，然后在编写插件 Apk 中的 Activity 组件时，不再让其集成 android.app.Activity，而是集成自我们的 PluginActivity。</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContainerActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> PluginActivity pluginActivity;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">pluginActivityName</span> <span class="hljs-operator">=</span> getIntent().getString(<span class="hljs-string">&quot;pluginActivityName&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);
        pluginActivity = PluginLoader.loadActivity(pluginActivityName, <span class="hljs-built_in">this</span>);
        <span class="hljs-keyword">if</span> (pluginActivity == <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
            <span class="hljs-keyword">return</span>;
        }

        pluginActivity.onCreate();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResume</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (pluginActivity == <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">super</span>.onResume();
            <span class="hljs-keyword">return</span>;
        }
        pluginActivity.onResume();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPause</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (pluginActivity == <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">super</span>.onPause();
            <span class="hljs-keyword">return</span>;
        }
        pluginActivity.onPause();
    }

    <span class="hljs-comment">// ...</span>
}
</code></pre>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginActivity</span> {
    <span class="hljs-keyword">private</span> ContainerActivity containerActivity;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PluginActivity</span><span class="hljs-params">(ContainerActivity containerActivity)</span> {
        <span class="hljs-built_in">this</span>.containerActivity = containerActivity;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">View</span>&gt; T <span class="hljs-title function_">findViewById</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> {
        <span class="hljs-keyword">return</span> containerActivity.findViewById(id);
    }
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<pre><code class="lang-java"><span class="hljs-comment">// 插件 `Apk` 中真正写的组件</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PluginActivity</span> {
    <span class="hljs-comment">// ......</span>
}
</code></pre>
<p>是不是感觉有点看懂了，虽然真正搞的时候还有很多小坑，但大概原理就是这么简单，启动插件组件需要依赖容器，容器负责加载插件组件并且完成双向转发，转发来自系统的生命周期回调至插件组件，同时转发来自插件组件的系统调用至系统。</p>
<h5 id="43-字节码替换">4.3 字节码替换</h5>
<p>该方式虽然能够很好的实现启动插件Activity的目的，但是由于开发式侵入性很强，插件中的Activity必须继承PluginActivity，如果想把之前的模块改造成插件需要很多额外的工作。</p>
<pre><code class="lang-java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {}
-&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TestActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PluginActivity</span> {}
</code></pre>
<p>有没有什么办法能让插件组件的编写与原来没有任何差别呢？</p>
<p>Shadow 的做法是字节码替换插件，这是一个非常棒的想法，简单来说，Android 提供了一些 Gradle 插件开发套件，其中有一项功能叫 Transform Api，它可以介入项目的构建过程，在字节码生成后、dex 文件生成前，对代码进行某些变换，具体怎么做的不说了，可以自己看文档。</p>
<p>实现的功能嘛，就是用户配置 Gradle 插件后，正常开发，依然编写：</p>
<pre><code class="lang-java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {}
</code></pre>
<p>然后完成编译后，最后的字节码中，显示的却是：</p>
<pre><code class="lang-java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PluginActivity</span> {}
</code></pre>
<h4 id="五、resource-injection">五、Resource Injection</h4>
<p>最后要说的是资源注入，其实这一点相当重要，Android 应用的开发其实崇尚的是逻辑与资源分离的理念，所有资源（layout、values 等）都会被打包到 Apk 中，然后生成一个对应的 R 类，其中包含对所有资源的引用 id。</p>
<p>资源的注入并不容易，好在 Android 系统给我们留了一条后路，最重要的是这两个接口：</p>
<ul>
<li>PackageManager#getPackageArchiveInfo：根据 Apk 路径解析一个未安装的 Apk 的 PackageInfo</li>
<li>PackageManager#getResourcesForApplication：根据 ApplicationInfo 创建一个 Resources 实例</li>
</ul>
<p>我们要做的就是在上面 ContainerActivity#onCreate 中加载插件 Apk 的时候，用这两个方法创建出来一份插件资源实例。具体来说就是先用 PackageManager#getPackageArchiveInfo 拿到插件 Apk 的 PackageInfo，有了 PacakgeInfo 之后我们就可以自己组装一份 ApplicationInfo，然后通过 PackageManager#getResourcesForApplication 来创建资源实例，大概代码像这样：</p>
<pre><code class="lang-java"><span class="hljs-type">PackageManager</span> <span class="hljs-variable">packageManager</span> <span class="hljs-operator">=</span> getPackageManager();
<span class="hljs-type">PackageInfo</span> <span class="hljs-variable">packageArchiveInfo</span> <span class="hljs-operator">=</span> packageManager.getPackageArchiveInfo(
    pluginApkPath,
    PackageManager.GET_ACTIVITIES
    | PackageManager.GET_META_DATA
    | PackageManager.GET_SERVICES
    | PackageManager.GET_PROVIDERS
    | PackageManager.GET_SIGNATURES
);
packageArchiveInfo.applicationInfo.sourceDir = pluginApkPath;
packageArchiveInfo.applicationInfo.publicSourceDir = pluginApkPath;

<span class="hljs-type">Resources</span> <span class="hljs-variable">injectResources</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
<span class="hljs-keyword">try</span> {
    injectResources = packageManager.getResourcesForApplication(packageArchiveInfo.applicationInfo);
} <span class="hljs-keyword">catch</span> (PackageManager.NameNotFoundException e) {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>拿到资源实例后，我们需要将宿主的资源和插件资源 Merge 一下，编写一个新的 Resources 类，用这样的方式完成自动代理：</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginResources</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Resources</span> {
    <span class="hljs-keyword">private</span> Resources hostResources;
    <span class="hljs-keyword">private</span> Resources injectResources;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PluginResources</span><span class="hljs-params">(Resources hostResources, Resources injectResources)</span> {
        <span class="hljs-built_in">super</span>(injectResources.getAssets(), injectResources.getDisplayMetrics(), injectResources.getConfiguration());
        <span class="hljs-built_in">this</span>.hostResources = hostResources;
        <span class="hljs-built_in">this</span>.injectResources = injectResources;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getString</span><span class="hljs-params">(<span class="hljs-type">int</span> id, Object... formatArgs)</span> <span class="hljs-keyword">throws</span> NotFoundException {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> injectResources.getString(id, formatArgs);
        } <span class="hljs-keyword">catch</span> (NotFoundException e) {
            <span class="hljs-keyword">return</span> hostResources.getString(id, formatArgs);
        }
    }

    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>然后我们在 ContainerActivity 完成插件组件加载后，创建一份 Merge 资源，再复写 ContainerActivity#getResources，将获取到的资源替换掉：</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContainerActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> Resources pluginResources;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-comment">// ...</span>
        pluginResources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PluginResources</span>(<span class="hljs-built_in">super</span>.getResources(), PluginLoader.getResources(pluginApkPath));
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Resources <span class="hljs-title function_">getResources</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (pluginActivity == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getResources();
        }
        <span class="hljs-keyword">return</span> pluginResources;
    }
}
</code></pre>
<p>这样就完成了资源的注入。</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="android通过gradle使用protobuf.html" class="navigation navigation-prev " aria-label="Previous page: android通过gradle使用protobuf">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="android插件化Hook实现.html" class="navigation navigation-next " aria-label="Next page: android插件化Hook实现">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"android插件化代理实现","level":"2.1.5","depth":2,"next":{"title":"android插件化Hook实现","level":"2.1.6","depth":2,"path":"android/android插件化Hook实现.md","ref":"android/android插件化Hook实现.md","articles":[]},"previous":{"title":"android通过gradle使用protobuf","level":"2.1.4","depth":2,"path":"android/android通过gradle使用protobuf.md","ref":"android/android通过gradle使用protobuf.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"android/android插件化代理实现.md","mtime":"2024-02-06T03:49:43.516Z","type":"markdown"},"gitbook":{"version":"5.1.4","time":"2024-07-12T11:23:21.120Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

